# TypeScript könyv órai feladat

## 1. lépés

Csinálj meg mindent az 5. lépésig [ebből a repoból](https://github.com/blaiseludvig/ts-alap).


## 2. lépés

Telepítsd fel ezeket a packageket **`npm install --save-dev`**-el.

```bash
css-loader
style-loader
mini-css-extract-plugin
bootstrap
typescript
webpack
webpack-cli
```

Egy soron:

```
npm install --save-dev css-loader style-loader mini-css-extract-plugin bootstrap typescript webpack webpack-cli
```

<br>

Készíts a **`package.json`**-ban egy build scriptet:

> package.json
```json
...
 "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "npx tsc && npx webpack"
  },
...
```

<br>

Add hozzá a projekthez ezt az előre elkészített **`webpack.config.cjs`** fájlt:

```js
const webpack = require("webpack");
const path = require("path");
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

const config = {
  entry: "./src/index.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "main.js",
  },
  optimization: {
    minimize: false,
  },
  mode: "development",
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [MiniCssExtractPlugin.loader, "css-loader"],
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin(),
  ],
};

module.exports = config;
```

<br>

Mivel csak az **`index.ts`** fájlban dolgozunk, ezért célszerű hozzáadni az automatikus generált **`index.js`** fájlt a **`.gitignore`**-hoz

> .gitignore fájl vége
```
...
# index file generated by TypeScript
src/index.js
```

<br>

És végül csináljunk egy GitHub Action-t, hogy az oldal megtekinthető legyen a GitHub-on.

A **`.github/workflows`** mappába hozzunk létre egy **`node_ci.yml`** fájlt, és másoljuk bele ezt az előre elkészített konfigurációt:

```yml
name: Node.js CI

on:
  push:
    branches:
      - master
      - main
  pull_request:
    branches:
      - master
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: '14'
        cache: 'npm'
    - run: npm ci
    - run: npm run build --if-present
    - name: Deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        publish_branch: gh-pages
```

<br>

A GitHub webes felületén nyissuk meg a repót, menjünk be a **Settings**-be, azon belül a **Pages** menübe, és ott a **Build and deployment** alatt állítsuk be a **Source**-t _Deploy from a branch_-re és a **Branch**-et _gh-pages_-re.

<br>

## 3. lépés

Az egyszerűség kedvéért a **``dist``** mappában fogjuk létrehozni az **`index.html`**-t.

> dist/index.html
```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="main.css">
  <script src="main.js" defer></script>

  <title>Könyvek</title>
</head>

<body>

</body>

</html>
```

A **`main.js`** és a **`main.css`** is a **`dist`** mappában van, figyelj az elérési útvonalakra!

<br>

Teszteljük le hogy működik-e:

> src/index.ts
```ts
import './style.css';
import 'bootstrap/dist/css/bootstrap.css';
import 'bootstrap/dist/js/bootstrap.bundle.js';

let element: HTMLHeadingElement = document.createElement('h1');
element.textContent = "Ha ezt látod, és zöld, akkor működik!";
// a text-success egy bootstrapes stílus
element.className = "text-success";
document.body.append(element);
```

Ha nem fut a fenti repoban megadott 2 terminálos folyamat, akkor nem fog működni!

<br>

## 4. lépés

Kezdjük el a feladatot!

Először hozzuk létre az osztályt, és teszteljük le:

> src/Book.ts
```ts
export class Book {
  name: string;
  rating: number = 0;

  constructor(name: string, rating: number) {
    this.name = name;
    this.rating = rating;
  }
}
```

> src/index.ts
```ts
import './style.css';
import 'bootstrap/dist/css/bootstrap.css';
import 'bootstrap/dist/js/bootstrap.bundle.js';
import { Book } from './Book';

let b: Book = new Book("SICP", 10);
console.log(b);
```

A Bootstrap miatt ez csak a böngészőben tud lefutni!

<br>

Csináljunk settert a `rating`-hez:

> src/index.ts
```ts
export class Book {
  name: string;
  private rating: number = 0;

  constructor(name: string, rating: number) {
    this.name = name;
    this.setRating(rating);
  }

  getRating(): number {
    return this.rating;
  }

  setRating(value: number): void {
    if (value >= 1 && value <= 10) {
      this.rating = value;
    } else if (value > 10) {
      this.rating = 10;
    } else if (value < 1) {
      this.rating = 1;
    }
  }
```

Itt használhatjuk a TypeScript `private` kulcsszavát is.

<br>

Adjuk hozzá a `toString()` metódust:

```ts
export class Book {
  name: string;
  private rating: number = 0;

  constructor(name: string, rating: number) {
    this.name = name;
    this.setRating(rating);
  }

  getRating(): number {
    return this.rating;
  }

  setRating(value: number): void {
    if (value >= 1 && value <= 10) {
      this.rating = value;
    } else if (value > 10) {
      this.rating = 10;
    } else if (value < 1) {
      this.rating = 1;
    }
  }

  toString(): string {
    return `cím: ${this.name} | értékelés: ${this.rating}/10`;
  }

}
```

> src/index.ts
```ts
import './style.css';
import 'bootstrap/dist/css/bootstrap.css';
import 'bootstrap/dist/js/bootstrap.bundle.js';
import { Book } from './Book';

let teszt_adat: Book[] = [];

teszt_adat.push(new Book("SICP", 11))
teszt_adat.push(new Book("asd", 1))
teszt_adat.push(new Book("amongus", -20))

console.log("teszt adat: ");
for (const b of teszt_adat) {
  console.log(b.toString());
}
```

<br>

Adjuk hozzá a **`Book.js`**-t is a **`.gitignore`**-hoz.

Ha nem tervezünk a jövőben JavaScript kódot használni a projektben, akkor akár minden JavaScript fájlt hozzáadhatunk a **`.gitignore`**-hoz


> .gitignore fájl vége
```
...
# project is TypeScript only
src/**/*.js
```

<br>

## 5. feladat

Készítsük el a plusz feladatot!

Írjuk meg a funkciót a random könyvekhez:

> src/index.ts
```ts
function randomKonyvek(): Book[] {
  let konyvek: Book[] = [];

  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random#getting_a_random_integer_between_two_values
  function getRandomInt(min: number, max: number) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min) + min);
  }

  for (let i = 0; i < 30; i++) {
    konyvek.push(new Book(`Book #${i}`, getRandomInt(1, 10 + 1)))
  }

  return konyvek;
}
```

<br>

Teszteljük le:

```ts
let random_konyvek: Book[] = randomKonyvek();

console.log("random könyvek címei: ");
for (const b of random_konyvek) {
  console.log(b.name);
}

console.log("nagyobb mint 7 értékelés: ");
for (const b of random_konyvek) {
  if (b.getRating() > 7) {
    console.log(b.toString());
  }
}
```

<br>

`bestof` funkció:

> src/index.js
```ts
function bestof(konyvek: Book[]): Book {
  let legjobb: Book = konyvek[0];

  for (const b of konyvek) {
    if (b.getRating() > legjobb.getRating()) {
      legjobb = b;
    }
  }

  return legjobb;
}
```

Tesztelés:

```ts
console.log(`Legjobb könyv: ${bestof(random_konyvek)}`);
```

## 6. lépés

Csináljunk egy egyszerű frontendet a Bootstrap segítsével!

> dist/index.html
```html
  <div class="w-50 m-3 p-2 border border-2 border-dark rounded">
    <input type="text" name="cim" id="input_cim" placeholder="SICP">
    <input type="number" min="1" max="10" name="rating" id="input_rating"
      placeholder="1-10">
    <button class="btn btn-success ms-3 fw-bold"
      id="btn_hozzaad">Hozzáad</button>
  </div>

  <div id="konyvek" class="w-50 m-3 p-2 border border-2 border-dark rounded">

  </div>
```

<br>

Szedjük össze az elemeket

> src/index.ts
```ts
let input_cim = (document.getElementById("input_cim") as HTMLInputElement);
let input_rating = (document.getElementById("input_rating") as HTMLInputElement);
let btn_hozzaad = (document.getElementById("btn_hozzaad") as HTMLButtonElement);
let konyvek = (document.getElementById("konyvek") as HTMLDivElement);
```

<br>

Készítsünk egy funkciót amivel hozzáadunk egy könyvet az oldalhoz:

> src/index.ts
```ts
function addKonyv(konyv: Book): void {
  let konyvElem = document.createElement("div");
  konyvElem.innerHTML =
    `
  <div>
  <span class="fw-bold">Cím:</span> ${konyv.name}
  <span class="fw-bold">Értékelés:</span> ${konyv.getRating()}/10
  <span class="text-danger fw-bold" role="button" onclick="this.parentElement.remove();">X</span>
  </div>
  `;

  konyvek.appendChild(konyvElem);

}
```

Az `onclick="this.parentElement.remove();"`-nál a `this` az elemre hivatkozik.

<br>

Adjunk egy eventListener-t a gombnak:

```ts
function init(): void {

  addKonyv(new Book("SICP", 10));

  btn_hozzaad.addEventListener("click", () => {

    if (input_cim.value == "" || input_rating.value == "") {
      return;
    }

    let rating: number = parseFloat(input_rating.value);
    // lekerekítjük 1 tizedesjegyre
    rating = parseFloat(rating.toFixed(1));
    addKonyv(new Book(input_cim.value, rating))

    input_cim.value = "";
    input_rating.value = "";

  })
}

init();
```
